#!/bin/sh
#
# lint
# Copyright Â© 2017 Matej Kosiarcik. All rights reserved.
# This file contains lint procedures for project's source code
#

# setup
set -euf
cd "$(dirname "${0}")/.."

# Swift
if command -v swiftlint >/dev/null 2>&1; then
    swiftlint lint 2>/dev/null
else
    printf "%s\n" "warning: swiftlint not found. (tool_not_found)"
fi

# Markdown
if command -v mdl >/dev/null 2>&1; then
    mdl . --git-recurse || true
else
    printf "%s\n" "warning: markdownlint(mdl) not found. (tool_not_found)"
fi

# Yaml
if command -v yamllint >/dev/null 2>&1; then
    yamllint . --format parsable --config-file ".yamllint.yml" || true
else
    printf "%s\n" "warning: yamllint not found. (tool_not_found)"
fi

# Shell
if command -v shellcheck >/dev/null 2>&1; then
    find "./Tools" -type f -not -name "\.*" | while IFS= read -r file; do
        shellcheck --format gcc "${file}" || true
    done
else
    printf "%s\n" "warning: shellcheck not found. (tool_not_found)"
fi
if command -v shfmt >/dev/null 2>&1; then
    find "./Tools" -type f -not -name "\.*" | while IFS= read -r file; do
        shfmt -i 4 -p -l "${file}" \
            | sed -E "s~(.*)~\1: warning: file badly formatted, run 'format' script to resolve (bad_format)~g"
    done
else
    printf "%s\n" "warning: shfmt not found. (tool_not_found)"
fi
