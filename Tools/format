#!/bin/sh
#
# format
# Copyright Â© 2017 Matej Kosiarcik. All rights reserved.
# This file contains formatting procedures for project's source code
#

# setup
set -euf
cd "$(dirname "${0}")/.."

# All
# this removes excessive whitespace
strip() {
    printf "%s\n" "$(cat -s "${1}")" >"${1}"                   # strip multiple empty lines and trailing newlines
    printf "%s\n" "$(sed 's~[[:space:]]*$~~' <"${1}")" >"${1}" # remove trailing whitespace
}
git ls-tree -r --name-only "HEAD" | while IFS= read -r file; do
    strip "${file}"
done

# Swift
if command -v swiftlint >/dev/null 2>&1; then
    swiftlint autocorrect 2>/dev/null
else
    printf "%s\n" "warning: swiftlint not found. (tool_not_found)"
fi

# Shell
if command -v shfmt >/dev/null 2>&1; then
    find "./Tools" -type f -not -name "\.*" | while IFS= read -r file; do
        shfmt -i 4 -p -w "${file}"
    done
else
    printf "%s\n" "warning: shfmt not found. (tool_not_found)"
fi
